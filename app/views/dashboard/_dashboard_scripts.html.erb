<!-- app/views/dashboard/_dashboard_scripts.html.erb -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dashboardTitle = document.getElementById('dashboardTitle');
        const summaryCard = document.getElementById('summaryCard');
        const tabContainer = document.getElementById('tabContainer');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        // Fade in and slide down for title
        dashboardTitle.style.opacity = '1';
        dashboardTitle.style.transform = 'translateY(0)';

        // Fade in and slide up for summary card and tab container
        summaryCard.style.opacity = '1';
        summaryCard.style.transform = 'translateY(0)';
        tabContainer.style.opacity = '1';
        tabContainer.style.transform = 'translateY(0)';

        function showTab(tabName) {
            tabButtons.forEach(button => {
                if (button.dataset.tab === tabName) {
                    button.style.backgroundColor = '#4f46e5';
                    button.style.color = 'white';
                } else {
                    button.style.backgroundColor = '#f3f4f6';
                    button.style.color = '#4b5563';
                }
            });

            tabContents.forEach(content => {
                if (content.id === tabName) {
                    content.style.display = 'block';
                    setTimeout(() => {
                        content.style.opacity = '1';
                        content.style.transform = 'translateY(0)';
                    }, 50);
                } else {
                    content.style.opacity = '0';
                    content.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        content.style.display = 'none';
                    }, 300);
                }
            });
        }

        tabButtons.forEach(button => {
            button.addEventListener('click', () => showTab(button.dataset.tab));
        });

        // Show initial tab
        showTab('owed');

        // Animate numbers
        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = '$' + (progress * (end - start) + start).toFixed(2);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        document.querySelectorAll('.animate-number').forEach(el => {
            const value = parseFloat(el.innerText.replace(/[^0-9.-]+/g,""));
            animateValue(el, 0, value, 1000);
        });

        // Create expense chart
        var ctx = document.getElementById('expenseChart').getContext('2d');
        var expenseChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: <%= raw @expense_categories.keys.to_json %>,
                datasets: [{
                    data: <%= raw @expense_categories.values.to_json %>,
                    backgroundColor: [
                        '#4F46E5', '#818CF8', '#10B981', '#F59E0B', '#EF4444', '#6B7280'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: {
                                size: 12
                            },
                            padding: 20
                        }
                    }
                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
    });
</script>